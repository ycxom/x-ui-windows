{{define "form/inbound"}}
<!-- base -->
<a-form layout="inline">
    <a-form-item label='{{ i18n "remark" }}'>
        <a-input v-model.trim="dbInbound.remark"></a-input>
    </a-form-item>
    <a-form-item label='{{ i18n "enable" }}'>
        <a-switch v-model="dbInbound.enable"></a-switch>
    </a-form-item>
    <a-form-item label='{{ i18n "protocol" }}'>
        <a-select v-model="inbound.protocol" style="width: 160px;">
            <a-select-option v-for="p in Protocols" :key="p" :value="p">[[ p ]]</a-select-option>
        </a-select>
    </a-form-item>
    <a-form-item>
        <span slot="label">
            {{ i18n "monitor" }}
            <a-tooltip>
                <template slot="title">
                    <span>{{ i18n "pages.inbounds.monitorDesc" }}</span>
                </template>
                <a-icon type="question-circle" theme="filled"></a-icon>
            </a-tooltip>
        </span>
        <a-input v-model.trim="inbound.listen"></a-input>
    </a-form-item>
    <a-form-item label='{{ i18n "pages.inbounds.port" }}'>
        <a-input type="number" v-model.number="inbound.port"></a-input>
    </a-form-item>
    
    <!-- Backend Address Configuration -->
    <a-form-item>
        <span slot="label">
            {{ i18n "pages.inbounds.enableBackend" }}
            <a-tooltip>
                <template slot="title">
                    <span>{{ i18n "pages.inbounds.enableBackendDesc" }}</span>
                </template>
                <a-icon type="question-circle" theme="filled"></a-icon>
            </a-tooltip>
        </span>
        <a-switch v-model="dbInbound.enableBackend" @change="onBackendToggle"></a-switch>
    </a-form-item>
    
    <!-- 初始化后端代理字段 -->
    <script>
        // 确保后端代理字段正确初始化
        if (typeof dbInbound !== 'undefined' && dbInbound) {
            // 从数据库读取的值或使用默认值
            dbInbound.enableBackend = dbInbound.enableBackend || false;
            dbInbound.backendAddress = dbInbound.backendAddress || "127.0.0.1";
            dbInbound.backendPort = dbInbound.backendPort || 10808;
            dbInbound.backendProtocol = dbInbound.backendProtocol || "http";
            
            // 使用Vue.set确保响应式绑定
            if (typeof Vue !== 'undefined' && Vue.set) {
                Vue.set(dbInbound, 'enableBackend', dbInbound.enableBackend);
                Vue.set(dbInbound, 'backendAddress', dbInbound.backendAddress);
                Vue.set(dbInbound, 'backendPort', dbInbound.backendPort);
                Vue.set(dbInbound, 'backendProtocol', dbInbound.backendProtocol);
            }
        }
    </script>
    
    <template v-if="dbInbound.enableBackend === true">
        <a-form-item label='{{ i18n "pages.inbounds.backendProtocol" }}'>
            <a-select v-model="dbInbound.backendProtocol" style="width: 160px;">
                <a-select-option value="http">HTTP</a-select-option>
                <a-select-option value="socks">SOCKS</a-select-option>
                <a-select-option value="dokodemo">Dokodemo-door</a-select-option>
            </a-select>
        </a-form-item>
        <a-form-item label='{{ i18n "pages.inbounds.backendAddress" }}'>
            <a-input v-model.trim="dbInbound.backendAddress" placeholder="192.168.1.1"></a-input>
        </a-form-item>
        <a-form-item label='{{ i18n "pages.inbounds.backendPort" }}'>
            <a-input type="number" v-model.number="dbInbound.backendPort" placeholder="8080"></a-input>
        </a-form-item>
    </template>
    
    <a-form-item>
        <span slot="label">
            <span >{{ i18n "pages.inbounds.totalFlow" }}</span>(GB)
            <a-tooltip>
                <template slot="title">
                    0 <span>{{ i18n "pages.inbounds.meansNoLimit" }}</span>
                </template>
                <a-icon type="question-circle" theme="filled"></a-icon>
            </a-tooltip>
        </span>
        <a-input-number v-model="dbInbound.totalGB" :min="0"></a-input-number>
    </a-form-item>
    <a-form-item>
        <span slot="label">
            <span >{{ i18n "pages.inbounds.expireDate" }}</span>
            <a-tooltip>
                <template slot="title">
                    <span>{{ i18n "pages.inbounds.leaveBlankToNeverExpire" }}</span>
                </template>
                <a-icon type="question-circle" theme="filled"></a-icon>
            </a-tooltip>
        </span>
        <a-date-picker :show-time="{ format: 'HH:mm' }" format="YYYY-MM-DD HH:mm"
                       v-model="dbInbound._expiryTime" style="width: 300px;"></a-date-picker>
    </a-form-item>
</a-form>

<!-- vmess settings -->
<template v-if="inbound.protocol === Protocols.VMESS">
    {{template "form/vmess"}}
</template>

<!-- vless settings -->
<template v-if="inbound.protocol === Protocols.VLESS">
    {{template "form/vless"}}
</template>

<!-- trojan settings -->
<template v-if="inbound.protocol === Protocols.TROJAN">
    {{template "form/trojan"}}
</template>

<!-- shadowsocks -->
<template v-if="inbound.protocol === Protocols.SHADOWSOCKS">
    {{template "form/shadowsocks"}}
</template>

<!-- dokodemo-door -->
<template v-if="inbound.protocol === Protocols.DOKODEMO">
    {{template "form/dokodemo"}}
</template>

<!-- socks -->
<template v-if="inbound.protocol === Protocols.SOCKS">
    {{template "form/socks"}}
</template>

<!-- http -->
<template v-if="inbound.protocol === Protocols.HTTP">
    {{template "form/http"}}
</template>

<!-- stream settings -->
<template v-if="inbound.canEnableStream()">
    {{template "form/streamSettings"}}
</template>

<!-- tls settings -->
<template v-if="inbound.canEnableTls()">
    {{template "form/tlsSettings"}}
</template>

<!-- sniffing -->
<template v-if="inbound.canSniffing()">
    {{template "form/sniffing"}}
</template>
{{end}}